
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Video Diagnostic Analyzer</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c3aed;
      --muted:#9aa4b2;
      --glass: rgba(255,255,255,0.03);
      color-scheme: dark    ;
      font-family: Garamond;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui;}
    body{
      background: linear-gradient(180deg, #131313 0%, #070707 60%);
      color:#e6eef8;
      padding:28px;
      box-sizing:border-box;
      font-family: Garamond;
    }
    .app{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:26px;
      margin-top: 20px;
    }
    header{
      grid-column:1/-1;
      margin-bottom:6px;
    }
    header h1{margin:0;font-size:20px;}
    header p{margin:0;color:var(--muted);font-size:13px}

    .panel{
      background:var(--glass);
      border-radius:12px;
      padding:18px;
      border:1px solid rgba(255,255,255,0.03);
      backdrop-filter:blur(4px);
    }

    .big-input{
      background:var(--glass);
      border-radius:10px;
      padding:14px;
      display:flex;
      gap:12px;
      border:1px dashed rgba(255,255,255,0.04);
    }
    .big-input input[type=file]{display:none}
    .btn{
      padding:10px 14px;
      background:linear-gradient(90deg,var(--accent),#4f46e5);
      border-radius:8px;
      cursor:pointer;
      color:white;
      font-weight:600;
      border:0;
    }

    .url-input{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .url-input input{
      flex:1;
      padding:10px 12px;
      border-radius:8px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:white;
    }
    .url-input button{
      padding:10px 12px;
      border-radius:8px;
      background:rgba(255,255,255,0.06);
      border:0;
      color:var(--muted);
      cursor:pointer;
    }

    /* VIDEO WRAPPER + OVERLAY */
    .video-wrapper{
      position:relative;
      margin-top:14px;
      border-radius:10px;
      overflow:hidden;
    }
    video{
      width:100%;
      max-height:420px;
      border-radius:10px;
      display:block;
      background:black;
    }
    #issueOverlay{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(255,0,0,0.28);
      border:2px solid red;
      border-radius:10px;
      backdrop-filter:blur(2px);
      color:white;
      font-size:28px;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:center;
      text-shadow:1px 1px 4px black;
      pointer-events:none;
      opacity:0;
      transition:opacity .35s;
    }

    .results{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .issue-card{
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:rgba(255,255,255,0.02);
      display:grid;
      grid-template-columns:1fr 120px;
      gap:10px;
    }
    .jump-btn{
      padding:8px;
      border-radius:8px;
      background:rgba(255,255,255,0.08);
      border:0;
      color:white;
      cursor:pointer;
    }
    .small{color:var(--muted);font-size:12px}

    .navbar {
  background: #2c3e50;
  padding: 15px 50px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: -25px;
}

.logo {
  color: #fff;
}

.navbar ul {
  list-style: none;
  display: flex;
  gap: 20px;
}

.navbar ul li a {
  color: #fff;
  text-decoration: none;
  font-weight: bold;
}

.navbar ul li a:hover {
  text-decoration: underline;
}
.hero {
  padding: 40px 20px;
  background: linear-gradient(135deg, #3498db, #2c3e50);
  color: white;
  border-radius: 0 0 40px 40px;
  margin-top: -10px;
}

.hero h1 {
  font-size: 40px;
  margin-top: -90px;
}

.hero p {
  font-size: 18px;
  margin-top: -0px;
}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>


</head>

<body>

  <header class="navbar">
    <h2 class="logo">Banking Support</h2>
    <nav>
      <ul>
        <li><a href="video.html">Video Analysis</a></li>
        <li><a href="home.html">Home</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
      </ul>
    </nav>
  </header>
  <section class="hero">
    
    <img src="List.png" height="130" width="150" alt="List" />
    <center>
      <h1>List Software Support Team</h1>
      <p>Submit your issue, and weâ€™ll find the best solution for you.</p>
    </center>
  </section>

<div class="app">
<header>
  <h1>Video Diagnostic Analyzer</h1>
  <p>Automatically detect screen problems, timestamps & fixes.</p>
</header>

<main class="left panel">

  <div class="big-input">
      <input id="fileInput" type="file" accept="video/*">
      <button id="chooseBtn" class="btn">Choose Video</button>
  </div>

  <div class="url-input">
    <input id="videoUrl" placeholder="Paste video URL">
    <button id="loadUrlBtn">Load</button>
    <button id="analyzeBtn">Analyze</button>
  </div>

  <!-- VIDEO + OVERLAY -->
  <div class="video-wrapper">
      <video id="video" controls crossorigin="anonymous"></video>
      <div id="issueOverlay"></div>
  </div>

  <div class="status small" id="statusText">Idle</div><br> 
  <div id="mainSummary" style="
  padding:15px;
  border-radius:8px;
  background:#1f2937;
  margin-bottom:12px;
  font-size:18px;
  font-weight:600;
  display:none;
"></div> 
  <div class="results" id="results"></div>
  


</main>



 <!-- ðŸ’¬ Chatbot -->
 <script src='https://cdn.jotfor.ms/agent/embedjs/019a57b5b33a7439995a3da4f028ac899a67/embed.js'>
</script>
  <footer>
    <p>Â© 2025 List Banking Support System. All Rights Reserved.</p>
  </footer>
</div>



<script>
/* ELEMENTS */
const fileInput = document.getElementById('fileInput');
const chooseBtn = document.getElementById('chooseBtn');
const loadUrlBtn = document.getElementById('loadUrlBtn');
const analyzeBtn = document.getElementById('analyzeBtn');
const videoUrl = document.getElementById('videoUrl');
const video = document.getElementById('video');
const statusText = document.getElementById('statusText');
const results = document.getElementById('results');
const overlay = document.getElementById('issueOverlay');

let issuesGlobal = [];

/* -----------------------------------------
      OVERLAY FUNCTION
------------------------------------------ */
function showOverlay(title, desc = "", duration = 2000) {
  overlay.innerHTML = `
    <div style="text-align:center;display:flex;flex-direction:column;gap:6px;padding:20px;">
      <div style="font-size:28px;font-weight:700;">${title}</div>
      <div style="font-size:18px;font-weight:400;opacity:0.9;">${desc}</div>
    </div>
  `;
  overlay.style.opacity = 1;
  setTimeout(() => overlay.style.opacity = 0, duration);
}

/* Auto Overlay Trigger */
video.addEventListener("timeupdate", () => {
  issuesGlobal.forEach(i => {
    if (Math.abs(video.currentTime - i.time) < 0.25) {
      showOverlay(i.title, i.desc);
    }
  });
});

/* -----------------------------------------
      VIDEO LOADERS
------------------------------------------ */
chooseBtn.onclick = () => fileInput.click();

fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  video.src = URL.createObjectURL(file);
  status("Loaded file");
};

loadUrlBtn.onclick = () => {
  const url = videoUrl.value.trim();
  if (!url) return;
  video.src = url;
  video.crossOrigin = "anonymous";
  status("Loaded URL");
};

function status(t) { statusText.textContent = t; }

function formatTime(t) {
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60);
  return `${m}:${String(s).padStart(2,"0")}`;
}

/* -----------------------------------------
      SMART ERROR-LINE EXTRACTOR
------------------------------------------ */
function extractExactErrorLine(ocrText) {
  if (!ocrText) return "";

  const patterns = [
    /ORA-\d{5}.*/i,
    /error.*$/i,
    /failed.*$/i,
    /exception.*$/i,
    /unable.*$/i,
    /warning.*$/i,
    /crash.*$/i
  ];

  const lines = ocrText.split("\n");

  for (let line of lines) {
    for (let p of patterns) {
      if (p.test(line)) {
        return line.trim();
      }
    }
  }
  return "";
}

/* -----------------------------------------
      ANALYSIS ENGINE
------------------------------------------ */
async function startAnalysis() {
  if (!video.src) return alert("Load a video first");

  issuesGlobal = [];
  results.innerHTML = "";
  status("Analyzing...");

  const duration = video.duration;
  const samples = 25;
  const times = [];
  for (let i = 0; i < samples; i++) times.push((i + 0.5) / samples * duration);

  const w = 1280;
  const h = Math.round(w * (video.videoHeight / video.videoWidth));

  const canvas = document.createElement("canvas");
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext("2d");

  const frames = [];

  for (let t of times) {
    await seek(t);

    ctx.drawImage(video, 0, 0, w, h);
    let img = ctx.getImageData(0, 0, w, h);

    // contrast boost
    for (let i = 0; i < img.data.length; i += 4) {
      img.data[i]     = Math.min(255, img.data[i] * 1.4);
      img.data[i + 1] = Math.min(255, img.data[i + 1] * 1.4);
      img.data[i + 2] = Math.min(255, img.data[i + 2] * 1.4);
    }
    ctx.putImageData(img, 0, 0);

    // brightness + blur
    img = ctx.getImageData(0, 0, w, h);
    let bright = 0, dark = 0;
    const gray = [];
    for (let i = 0; i < img.data.length; i += 4) {
      const lum = img.data[i] * 0.299 + img.data[i+1] * 0.587 + img.data[i+2] * 0.114;
      gray.push(lum);
      bright += lum;
      if (lum < 15) dark++;
    }

    const avgBright = bright / gray.length;
    const blackRatio = dark / gray.length;
    const lapVar = calcBlur(gray, w, h);
    const screenshot = canvas.toDataURL("image/png");

    // OCR detection
    let ocrText = "";
    try {
      const res = await Tesseract.recognize(canvas, "eng");
      ocrText = res.data.text.trim();
    } catch {
      ocrText = "";
    }

    frames.push({
      time: t,
      avgBright,
      blackRatio,
      lapVar,
      gray,
      ocrText,
      canvasImage: screenshot
    });
  }

  const issues = detectFrames(frames);
  issuesGlobal = issues;
  displayResults(issues);

  status("Analysis complete");
}

analyzeBtn.onclick = startAnalysis;

/* -----------------------------------------
      SEEK FUNCTION
------------------------------------------ */
function seek(t){
  return new Promise(resolve => {
    const handler = () => {
      video.removeEventListener("seeked", handler);
      setTimeout(resolve, 30);
    };
    video.addEventListener("seeked", handler);
    video.currentTime = t;
  });
}

/* -----------------------------------------
      DETECTION RULES
------------------------------------------ */
function detectFrames(frames){
  const issues = [];

  // BLACK FRAME
  const black = frames.find(f => f.blackRatio > 0.85);
  if (black) issues.push({
    time: black.time,
    title: "BLACK FRAME",
    desc: "Frame is almost completely black.",
    solution: "Verify screen capture settings."
  });

  // BLUR
  const blur = frames.find(f => f.lapVar < 30);
  if (blur) issues.push({
    time: blur.time,
    title: "BLUR DETECTED",
    desc: "Low sharpness detected.",
    solution: "Improve resolution."
  });

  // FREEZE
  for (let i = 1; i < frames.length; i++) {
    if (sameFrame(frames[i-1], frames[i])) {
      issues.push({
        time: frames[i].time,
        title: "FREEZE DETECTED",
        desc: "Two frames look identical.",
        solution: "Recording freeze detected."
      });
      break;
    }
  }

  // SHAKE
  let shake = 0;
  for (let i = 1; i < frames.length; i++)
    shake += Math.abs(frames[i].avgBright - frames[i-1].avgBright);

  if (shake > 18)
    issues.push({
      time: frames[Math.floor(frames.length/2)].time,
      title: "SCREEN SHAKE",
      desc: "Unstable frame pattern detected.",
      solution: "Use a stable screen recorder."
    });

  // OCR ERROR DETECTION
  frames.forEach(f => {
    const errorLine = extractExactErrorLine(f.ocrText);
    if (errorLine) {
      issues.push({
        time: f.time,
        title: "ON-SCREEN ERROR DETECTED",
        desc: errorLine,
        errorLine: errorLine,
        solution: "Check the software error message.",
        screenshot: f.canvasImage,
        ocrText: f.ocrText
      });
    }
  });

  return issues;
}

/* -----------------------------------------
      BLUR
------------------------------------------ */
function calcBlur(gray,w,h){
  let sum=0, sq=0;
  for(let i=w+1;i<gray.length-w-1;i++){
    const lap = -4*gray[i] + gray[i-1] + gray[i+1] + gray[i-w] + gray[i+w];
    sum += lap;
    sq += lap*lap;
  }
  const mean=sum/gray.length;
  return (sq/gray.length) - mean*mean;
}

/* -----------------------------------------
      FREEZE CHECK
------------------------------------------ */
function sameFrame(a,b){
  let diff=0;
  for(let i=0;i<a.gray.length;i+=5){
    if (Math.abs(a.gray[i] - b.gray[i]) > 3) diff++;
  }
  return diff < 20;
}

/* -----------------------------------------
      DISPLAY RESULTS
------------------------------------------ */
function displayResults(issues){
  results.innerHTML = "";

  if (!issues.length) {
    results.innerHTML = `<div class="issue-card"><div>No issues detected.</div></div>`;
    return;
  }

  issues.forEach(i=>{
    const div = document.createElement("div");
    div.className="issue-card";

    const screenshotHtml = i.screenshot ? `
      <div style="margin-top:10px">
        <img src="${i.screenshot}" style="width:100%;border-radius:8px;">
      </div>` : "";

    const ocrHtml = i.ocrText ? `<p><strong>OCR:</strong> ${escapeHtml(i.ocrText)}</p>` : "";

    div.innerHTML = `
      <div>
        <h3>${escapeHtml(i.title)}</h3>
        <p><strong>Error:</strong> ${escapeHtml(i.errorLine || i.desc)}</p>
        <p><strong>Solution:</strong> ${escapeHtml(i.solution)}</p>
        ${ocrHtml}
        ${screenshotHtml}
      </div>
      <button class="jump-btn">Jump ${formatTime(i.time)}</button>
    `;

    div.querySelector("button").onclick = ()=>{
      video.currentTime = i.time;
      video.play();
      showOverlay(i.title, i.errorLine || i.desc);
    };

    results.appendChild(div);
  });
}

/* Escape HTML */
function escapeHtml(str) {
  if (!str) return "";
  return str.replace(/[&<>"']/g, m => (
    {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]
  ));
}
</script>





</body>
</html>  